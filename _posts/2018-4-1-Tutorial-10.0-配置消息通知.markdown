---
layout: post
title:  "配置消息通知"
date:   2018-04-01
visible: 1
---

消息通知有助于企业人员或部门的协同，提高工作效率。当重要事件发生时，系统可以以消息的方式主动推送通知给相关用户，从而获得及时的反应。消息通知在企业应用软件中的用途很多。例如，在我们的“事务跟踪管理”系统中，当某个事务的状态变为“已完成”时，我们可以使用消息的方式通知事务提交人，以便提交人及时查看事务的处理结果。这个教程，我们就介绍如何配置这个需求。

#### 配置通知事务提交人消息

配置消息通知需要使用DesignStudio工具。

* 打开DesignStudio工具 => 以admin用户登录到“事务跟踪管理”数据库；
* 在左边导航栏选择“事务”数据类 => 右边选择“事件订阅”选项卡；
* 点击“添加”按键，创建了一个“Subscriber1”的事件订阅器。见下图：

<img src="{{'/assets/img/2018-4-1-创建事件订阅器.png' | prepend: site.baseurl }}" alt="">

* 选择“Subscriber”订阅器 => 在右边按照下表进行配置：

| 设置参数名 | 设置参数值 | 描述 |
|-------|--------|---------|
| 名称 | 事务完成事件订阅器 | 订阅器的名称 |
| 事件名称 | IssueFixed | 所订阅的事件名称。该事件是在教程9.1创建的。 |
| Url | app.smartforms.ebaasform | 查看产生事件的事务信息的Web界面模块的Url。这里使用的是表单界面 |
| Url参数 | {"schema": msg.dbschema, "class": msg.dbclass, "oid":msg.oid} | Web界面模块所需的参数，包括数据库，数据类和数据实例的内键 |
| 内容 | 关于{Subject}的事务已完成 | 发送消息的内容，其中{Subject}为变量，将被事务的主题所替代。内容将在界面显示 |
| 是否发送消息 | True | True表示事件发生时，发送消息通知给接收者 |
| 是否发邮件 | False | False表示不发送邮件 |
| 通知主题 | 您提交的事务已完成 | 发送消息的简短主题，将在界面显示 |
| 值为接收者的属性 | 提交人 | 指定“事务”的“提交人”属性的值为消息的接收者 |
| 值为发送者的属性 | 处理人 | 指定“事务”的“处理人”属性的值为消息的发送者。设置为可选。如果不选择，发送者为系统 |

配置图如下所示: 
<img src="{{'/assets/img/2018-4-1-配置事件订阅器.png' | prepend: site.baseurl }}" alt="">

点击工具栏的“保存到数据库”图标将修改的模型保存到数据库。见下图：
<img src="{{'/assets/img/2018-4-1-保存到数据库.png' | prepend: site.baseurl }}" alt="">

#### 测试消息通知



