---
layout: post
title:  "设置表单字段自动填充"
date:   2018-03-01
visible: 1
---

在许多应用场景，表单中的某些字段具有一定关联逻辑，这意味着某个字段值的更改可能会导致其他字段值的更改。例如，在“事务”表单中，当事务的“状态”变为“关闭”时，可以自动将表单中“进度”字段的值自动填充为100，或将“关闭日期”字段的值填充为当前日期，而不需要用户手工填充。

您可以使用DesignStudio在数据模型中配置来实现自动填充的逻辑。

#### 实现回调函数

编写填充逻辑的位置是“事务”数据类的“回调函数程序”。

单击“回调函数程序”设置打开代码编辑器，将以下代码复制粘贴到编辑器。

{% highlight ruby %}
if (this.Property == "Status")
{
  string status = this.Instance.GetString("Status");
  if (status == "关闭")
  {
      this.Instance.SetValue("进度", "100");
      this.Instance.SetValue("关闭日期", CurrentDate);
  }
}
{% endhighlight %}

提示：由于“回调函数程序”可以被表单中多个字段值的变化激活。所以，需要用<code>if (this.Property ==“Status”)</code> 语句来判断是否是“Status”这个字段值变化所激活的回调函数，以便区分其它字段值变化所激活的回调函数。

#### 在“状态”属性上启用回调

接下来，您需要通过将“使用调用回调”设置为“True”来启用“状态”属性上的回调。

#### 测试表单自动填充

现在，打开“事务”表单进行编辑，将“状态”的值更改为“关闭”，观察“进度”字段的值应变为100和“关闭日期”字段的值因为当前日期。
