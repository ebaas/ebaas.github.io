---
layout: post
title:  "配置工作流状态"
date:   2018-03-24
visible: 1
---

WF要求您的状态机工作流将一个状态标记为初始状态，将一个状态标记为已完成状态。当工作流程开始时，工作流程将从标记为初始状态的状态开始。当工作流程达到完成状态时，工作流程将结束。

定义每个州发生的活动

状态机工作流程从状态转移到状态。当它们处于每种状态（除完成状态之外）时，它们可以执行操作，等待外部事件发生并转换到另一个状态。

您可以将四项活动添加到州活动中：

StateInitialization活动（如果存在）是工作流进入状态时执行的第一个活动。该活动是一个序列活动，因此您可以将其添加到工作流进入该状态时要执行的所有活动。例如，您想添加一个CreateTask活动来为用户或一组用户创建工作流任务。
在状态机工作流程中，工作流程将进入状态并保持到状态发生。您使用EventDriven活动来处理事件。它也是一个序列活动，所以你可以添加活动来处理事件。
StateFinalization活动（如果存在）是工作流离开状态时执行的最后一个活动。它也是一个序列活动，因此您可以在工作流转移到新状态之前添加您想要执行的所有活动。例如，您想添加一个CloseTask活动来删除在工作流程进入状态时创建的任务。你现在将完成这个工作流程。您将定义每种状态下发生的情况以及工作流程从状态到状态的变化。
为“已启动”状态创建一个任务

当工作流程进入“已启动”状态时，它会为具有管理员角色的用户创建一个任务，以向拥有者分配问题或拒绝该问题。您可以使用CreateTask活动来实现它。

从工具箱中，将StateInitialization活动拖入Started活动，将其名称更改为StartedStateInitialization。 StateInitialization是一个序列活动。要向其添加活动，请双击它。工作流设计器如图11所示。

图11：StateInitialization活动是一个序列活动

将CreateTask活动从工具箱拖动到StartedStateInitialization中，并将其名称更改为“CreateAssignTask”。点击CreateAssignTask，切换到“属性”标签来设置活动。

用关于任务的文本设置“主题”和“任务描述”属性（参见图12）。有关任务的文本将显示在用户界面或通知电子邮件中。您可以使用{attribute name}语法将绑定数据实例的属性值包含为文本的一部分，例如{SubmitBy}或{SubmitDate}。
图12：设置任务的文本

通过单击“静态分配”下的“角色”，选择“经理”角色，然后单击“确定”（请参见图13），将任务分配给“经理”角色，这意味着具有经理角色的用户将获得任务。
图13：将任务分配给“经理”角色

您需要为此任务创建两个“已分配”和“已拒绝”操作。这些操作在任务表单底部显示为按钮。当点击“分配”按钮时，它将问题的“状态”设置为“已分配”，这会引发您先前定义的“分配已分配”事件。当单击“拒绝”按钮时，它将状态设置为“拒绝”，这会引发“问题拒绝”事件。创建“分配”动作的步骤如图14所示。
图14：创建“分配”操作

行动代码是：

this.Instance.SetValue（“状态”，“分配”）;
您可以使用相同的方式创建“拒绝”操作，但操作代码为：
this.Instance.SetValue（“状态”，“拒绝”）;
关闭“已启动”状态的任务

当工作流程离开“Started”状态时，它应该删除StartedStateInitializat中创建的任务。

定义状态转换

您现在已经完成了为问题跟踪流程创建的所有活动。剩下的唯一事情就是定义各州之间的转换。

定义两个状态之间的转换很容易。例如，要从Started状态转换为Working状态，请选择Started状态下的AssignedEventDriven活动，将鼠标悬停在活动的右边界上方。光标应该变成十字准线。按住鼠标按钮。拖动十字准线并将其放在工作状态。然后会有一条线连接这两个状态。

将Started状态下的RejectEventDriven活动连接到Finished状态，将FixedEventDriven工作状态连接到Finished状态。设计表面的最终工作流程如图21所示。

图21：定义由行指示的状态转换

将工作流模型保存到数据库

在将工作流程模型保存到数据库之前，您可能需要验证模型。如果没有验证错误，请单击工具栏上的“保存到数据库”图标。如果有一个对话框询问您是否将工作流模型保存为新版本，因为有其他模型的一些工作流实例正在运行，请回答“否”（参见图22）。等待完成消息。

图22：将工作流模型保存到数据库
